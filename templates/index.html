<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Todo App</title>

    <!-- Bootstrap 5 CSS (CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Ä°konlar (Bootstrap Icons CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <style>
      /* Toast konumlandÄ±rma */
      .toast-container {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        z-index: 1100;
      }
    </style>
  </head>

  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-white bg-white shadow-sm position-relative">
  <div class="container">
    <a class="navbar-brand fw-bold" href="{{ url_for('index') }}">
      <i class="bi bi-check2-square"></i> MyTodo
    </a>

    <span class="text-muted small position-absolute top-50 start-50 translate-middle">
      DetaylÄ± GÃ¶rev YÃ¶netimi
    </span>

    <a href="{{ url_for('new_task') }}" class="btn btn-primary btn-sm">
      <i class="bi bi-plus-lg"></i> Yeni GÃ¶rev Ekle
    </a>
  </div>
</nav>



    <main class="container-fluid py-3">
      <!-- TOAST MESAJLARI -->
      <div class="toast-container">
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, msg in messages %}
        <div
          class="toast align-items-center text-bg-{{ 'success' if category=='success' else ('warning' if category=='warning' else 'danger') }} border-0"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div class="d-flex">
            <div class="toast-body">{{ msg }}</div>
            <button
              type="button"
              class="btn-close btn-close-white me-2 m-auto"
              data-bs-dismiss="toast"
              aria-label="Kapat"
            ></button>
          </div>
        </div>
        {% endfor %} {% endif %} {% endwith %}
      </div>

      <!-- BURADAN Ä°TÄ°BAREN SAYFA Ä°Ã‡ERÄ°ÄžÄ° -->
      <div class="row g-3">
        <!-- Kart: Yeni gÃ¶rev ekleme 
        <div class="col-12">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5 class="card-title mb-3">Yeni GÃ¶rev Ekle</h5>
              <div class="row g-2">
                <div class="col-9">
                  <input
                    type="text"
                    class="form-control form-control-lg"
                    placeholder="GÃ¶rev BaÅŸlÄ±ÄŸÄ±nÄ± yazÄ±n"
                    disabled
                  />
                </div>
                <div class="col-3 d-grid">
                  <a
                    href="{{ url_for('new_task') }}"
                    class="btn btn-primary btn-lg d-block"
                  >
                    <i class="bi bi-plus-lg"></i> Yeni GÃ¶rev Ekle
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
-->
        <!-- SOL PANEL: AÃ§Ä±lan gÃ¶revler listesi -->
        <div class="col-lg-6 left-panel">
          <div class="card shadow-sm mb-3">
            <div class="card-header bg-white">
              <strong
                ><i class="bi bi-list-task me-2"></i> AÃ§Ä±lan GÃ¶revler</strong
              >
            </div>
            <div class="card-body p-2">
              <!-- FÄ°LTRE BUTONLARI -->
              <div class="d-flex flex-wrap gap-1 mb-3">
                <button class="btn btn-sm btn-danger flex-fill">
                  ðŸ”´ GecikmiÅŸ
                </button>
                <button class="btn btn-sm btn-secondary flex-fill">
                  âšª ZamanÄ± GelmemiÅŸ
                </button>
                <button class="btn btn-sm btn-success flex-fill">
                  ðŸŸ¢ ZamanÄ±nda BitmiÅŸ
                </button>
                <button class="btn btn-sm btn-primary flex-fill">
                  ðŸ”µ Erken BitmiÅŸ
                </button>
              </div>

              <div class="d-flex flex-wrap gap-1 mb-3">
                <button class="btn btn-sm btn-warning flex-fill">
                  ðŸŸ¨ Bekleyen
                </button>
                <button class="btn btn-sm btn-primary flex-fill">
                  ðŸŸ¦ Ä°ÅŸlemde
                </button>
                <button class="btn btn-sm btn-success flex-fill">
                  ðŸŸ© TamamlanmÄ±ÅŸ
                </button>
              </div>

              <div class="d-flex flex-wrap gap-1 mb-3">
                <button class="btn btn-sm btn-danger flex-fill">
                  ðŸ”´ Acil
                </button>
                <button class="btn btn-sm btn-primary flex-fill">
                  ðŸ”µ Orta
                </button>
                <button class="btn btn-sm btn-secondary flex-fill">
                  âšª Ã–nemsiz
                </button>
              </div>

              <!-- GÃ–REV LÄ°STESÄ° TABLOSU -->
              <div
                class="table-responsive"
                style="max-height: calc(100vh - 300px); overflow-y: auto"
              >
                {% if tasks %}
                <table class="table table-sm table-hover small mb-0">
                  <thead>
                    <tr>
                      <th>GÃ¶rev AdÄ±</th>
                      <th class="text-nowrap">AÃ§Ä±lma Tarihi</th>
                      <th class="text-end">Aksiyonlar</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for task in tasks %}
                    <tr>
                      <td class="align-middle fw-bold">{{ task.title }}</td>
                      <td class="align-middle text-nowrap">
                        {{ task.created_at.strftime('%Y-%m-%d') }}
                      </td>
                      <td class="text-end text-nowrap align-middle">
                        {% if task.status == 'pending' %}
  <a href="{{ url_for('start_task', id=task.id) }}" class="btn btn-sm btn-primary p-1"
     {% if active_task %} disabled {% endif %}>
    <i class="bi bi-play-fill"></i> BaÅŸlat
  </a>
{% endif %}


                        <a
                          href="{{ url_for('edit', id=task.id) }}"
                          class="btn btn-sm btn-warning p-1"
                          title="DÃ¼zenle"
                        >
                          <i class="bi bi-pencil-square"></i>
                        </a>
                        <form
                          action="{{ url_for('delete_task', id=task.id) }}"
                          method="POST"
                          class="d-inline"
                        >
                          <button
                            type="submit"
                            class="btn btn-sm btn-danger p-1"
                            title="Sil"
                            onclick="return confirm('GÃ¶revi silmek istediÄŸine emin misin?');"
                          >
                            <i class="bi bi-trash"></i>
                          </button>
                        </form>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                {% else %}
                <p class="text-muted small mb-0 p-2 text-center">
                  HenÃ¼z aÃ§Ä±k gÃ¶rev yok.
                </p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- ORTA PANEL ve SAÄž PANEL BURADA -->
        <!-- ORTA PANEL: Durum ve Ã–ncelik KartlarÄ± -->
        <!-- ORTA PANEL: Durum ve Ã–ncelik KartlarÄ± + Detay KartÄ± -->
<div class="col-lg-6">
    <div class="row g-3">
        <!-- Ãœstte iki kart yan yana -->
        <div class="col-6">
            <!-- GÃ¶rev Durumu KartÄ± -->
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <strong><i class="bi bi-list-check me-2"></i> GÃ¶rev Durumu</strong>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Bekleyen</span>
                        <span class="badge bg-warning text-dark">
                            {{ tasks|selectattr('status','equalto','pending')|list|length }}
                        </span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Ä°ÅŸlemde</span>
                        <span class="badge bg-primary">
                            {{ tasks|selectattr('status','equalto','in_progress')|list|length }}
                        </span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>TamamlanmÄ±ÅŸ</span>
                        <span class="badge bg-success">
                            {{ tasks|selectattr('status','equalto','completed')|list|length }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-6">
            <!-- Ã–ncelik KartÄ± -->
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <strong><i class="bi bi-exclamation-circle me-2"></i> Ã–ncelik</strong>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Acil</span>
                        <span class="badge bg-danger">
                            {{ tasks|selectattr('priority','equalto','high')|list|length }}
                        </span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Orta</span>
                        <span class="badge bg-primary">
                            {{ tasks|selectattr('priority','equalto','medium')|list|length }}
                        </span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Ã–nemsiz</span>
                        <span class="badge bg-secondary">
                            {{ tasks|selectattr('priority','equalto','low')|list|length }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

    
        <!-- AltÄ±nda tek kart: SeÃ§ili GÃ¶rev Detay KartÄ± -->
<div class="col-12">
    {% if active_task %}
    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <strong><i class="bi bi-info-circle me-2"></i> Ä°ÅŸlemdeki GÃ¶revin DetayÄ±</strong>
        </div>
        <div class="card-body">
            <div class="row g-2">
                <!-- BaÅŸlÄ±k -->
                <div class="col-md-3 fw-bold">BaÅŸlÄ±k:</div>
                <div class="col-md-3">{{ active_task.title }}</div>

                <!-- AÃ§Ä±klama -->
                <div class="col-md-3 fw-bold">AÃ§Ä±klama:</div>
                <div class="col-md-3">{{ active_task.description or "Yok" }}</div>

                <!-- BaÅŸlama Tarihi -->
                <div class="col-md-3 fw-bold">BaÅŸlama Tarihi:</div>
                <div class="col-md-3">
                    {{ active_task.started_at.strftime('%Y-%m-%d') if active_task.started_at else "BelirtilmemiÅŸ" }}
                </div>

                <!-- Tahmini BitiÅŸ -->
                <div class="col-md-3 fw-bold">Tahmini BitiÅŸ:</div>
                <div class="col-md-3">
                    {{ active_task.due_date.strftime('%Y-%m-%d') if active_task.due_date else "BelirtilmemiÅŸ" }}
                </div>

                <!-- Ã–ncelik ve Zaman Durumu yan yana -->
<div class="row g-2 align-items-center">
    <!-- Ã–ncelik -->
    <div class="col-md-6 d-flex align-items-center">
        <div class="fw-bold me-2">Ã–ncelik:</div>
        {% if active_task.priority == 'high' %}
            <span class="badge bg-danger">Acil</span>
        {% elif active_task.priority == 'medium' %}
            <span class="badge bg-primary">Orta</span>
        {% elif active_task.priority == 'low' %}
            <span class="badge bg-secondary">Ã–nemsiz</span>
        {% endif %}
    </div>

    <!-- Zaman Durumu -->
    <div class="col-md-6 d-flex align-items-center">
        <div class="fw-bold me-2">Zaman Durumu:</div>
        {% if active_task.due_date %}
            {% if active_task.due_date.date() < today %}
                <span class="badge bg-danger">GecikmiÅŸ</span>
            {% elif active_task.completed_at and active_task.due_date.date() >= active_task.completed_at.date() %}
                <span class="badge bg-success">ZamanÄ±nda BitmiÅŸ</span>
            {% elif not active_task.start_at %}
                <span class="badge bg-secondary">ZamanÄ± GelmemiÅŸ</span>
            {% else %}
                <span class="badge bg-primary">Erken BitmiÅŸ</span>
            {% endif %}
        {% else %}
            <span class="badge bg-dark">Tarih Yok</span>
        {% endif %}
    </div>
</div>

            </div>

            <hr>

            <!-- Butonlar ve kalan sÃ¼re -->
            <div class="d-flex justify-content-between align-items-center mt-2">
                <div class="d-flex gap-2">
                    {% if active_task %}
    {% if active_task.status == 'in_progress' %}
  <a href="{{ url_for('pause_task', id=active_task.id) }}" class="btn btn-warning">Duraklat</a>
  <a href="{{ url_for('finish_task', id=active_task.id) }}" class="btn btn-success">Bitir</a>
{% endif %}
{% else %}
    <div class="text-center text-muted">BaÅŸlatÄ±lacak gÃ¶rev yok.</div>
{% endif %}

                </div>
                <!-- Kalan sÃ¼re -->
                <div class="text-end fw-bold">
                    {% if active_task.due_date and active_task.started_at %}
                        {% set remaining_time = (active_task.due_date - active_task.started_at).days %}
                        Kalan: {{ remaining_time }} gÃ¼n
                    {% else %}
                        Kalan sÃ¼re yok
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="card shadow-sm">
        <div class="card-body text-center text-muted">
            BaÅŸlatÄ±lmÄ±ÅŸ gÃ¶rev yok.
        </div>
    </div>
    {% endif %}
</div>

  
</div>
      </div>
    </main>

    <!-- Bootstrap 5 JS Bundle (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Toast otomatik gÃ¶sterme ve kapanma -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var toastElList = [].slice.call(document.querySelectorAll(".toast"));
        var toastList = toastElList.map(function (toastEl) {
          var t = new bootstrap.Toast(toastEl, { delay: 3000 }); // 3 saniye
          t.show();
          return t;
        });
      });
    </script>
  </body>
</html>
