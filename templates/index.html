<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Todo App</title>

    <!-- Bootstrap 5 CSS (CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- İkonlar (Bootstrap Icons CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Özel CSS -->
    <!-- Bu dosya statik klasörde mevcut olmalıdır. -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>

  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-white bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand fw-bold" href="{{ url_for('index') }}">
          <i class="bi bi-check2-square"></i> MyTodo
        </a>
        <div class="d-flex">
          <span class="text-muted small">Detaylı Görev Yönetimi</span>
        </div>
      </div>
    </nav>
    <main class="container-fluid py-3">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="row justify-content-center mb-2">
        <div class="col-lg-10">
          {% for category, msg in messages %}
          <div
            class="alert alert-{{ 'success' if category=='success' else ('warning' if category=='warning' else 'danger') }} alert-dismissible fade show"
            role="alert"
          >
            {{ msg }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Kapat"
            ></button>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %} {% endwith %}

      <div class="row g-3">
        <!-- Kart: Yeni görev ekleme -->
        <div class="col-12">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5 class="card-title mb-3">Yeni Görev Ekle</h5>
              <form action="{{ url_for('add') }}" method="POST" class="row g-2">
                <!-- Basit ekleme formu, AŞAMA 3'te detaylandıracağız -->
                <div class="col-9">
                  <input
                    type="text"
                    name="title"
                    class="form-control form-control-lg"
                    placeholder="Görev Başlığını yazın (ör. E-posta gönder)"
                    required
                  />
                  <!-- todoitem yerine title kullanıldı -->
                </div>
                <div class="col-3 d-grid">
                  <button class="btn btn-primary btn-lg" type="submit">
                    <i class="bi bi-plus-lg"></i> Ekle
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- SOL PANEL: Açılan görevler listesi -->
        <div class="col-lg-3 left-panel">
          <div class="card shadow-sm mb-3">
            <div class="card-header bg-white">
              <strong
                ><i class="bi bi-list-task me-2"></i> Açılan Görevler</strong
              >
            </div>
            <div class="card-body p-2">
              <!-- FİLTRE BUTONLARI -->
              <div class="d-flex flex-wrap gap-1 mb-3">
                <button class="btn btn-sm btn-danger flex-fill">
                  Gecikmiş
                </button>
                <button class="btn btn-sm btn-secondary flex-fill">
                  Zamanı Gelmemiş
                </button>
                <button class="btn btn-sm btn-success flex-fill">
                  Zamanında Bitmiş
                </button>
                <button class="btn btn-sm btn-primary flex-fill">
                  Erken Bitmiş
                </button>
              </div>

              <!-- GÖREV LİSTESİ TABLOSU -->
              <!-- Küçük ekranda yatay kaydırma için responsive div -->
              <div
                class="table-responsive"
                style="max-height: calc(100vh - 300px); overflow-y: auto"
              >
                {% if tasks %}
                <table class="table table-sm table-hover small mb-0">
                  <thead>
                    <tr>
                      <th>Görev Adı</th>
                      <th class="text-nowrap">Açılma Tarihi</th>
                      <th class="text-end">Aksiyonlar</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for task in tasks %}
                    <tr>
                      <!-- Görev Adı -->
                      <td class="align-middle fw-bold">
                        <!-- Görev durumuna göre başlığa hafif bir stil ekleyebiliriz -->
                        {{ task.title }}
                      </td>

                      <!-- Açılma Tarihi (created_at) -->
                      <td class="align-middle text-nowrap">
                        {{ task.created_at.strftime('%Y-%m-%d') }}
                      </td>

                      <!-- Aksiyon Butonları -->
                      <td class="text-end text-nowrap align-middle">
                        <!-- Başlat Butonu -->
                        {% if task.status == 'pending' %}
                        <!-- 'start' rotası yerine, durumu 'in_progress' yapacak bir rota kullanacağız -->
                        <a
                          href="{{ url_for('update_status', id=task.id, new_status='in_progress') }}"
                          class="btn btn-sm btn-success p-1"
                          title="Başlat"
                        >
                          <i class="bi bi-play-fill"></i>
                        </a>
                        {% endif %}

                        <!-- Düzenle Butonu -->
                        <a
                          href="{{ url_for('edit', id=task.id) }}"
                          class="btn btn-sm btn-warning p-1"
                          title="Düzenle"
                        >
                          <i class="bi bi-pencil-square"></i>
                        </a>

                        <!-- Sil Butonu (POST Formu) -->
                        <form
                          action="{{ url_for('delete_task', id=task.id) }}"
                          method="POST"
                          class="d-inline"
                        >
                          <button
                            type="submit"
                            class="btn btn-sm btn-danger p-1"
                            title="Sil"
                            onclick="return confirm('Görevi silmek istediğine emin misin?');"
                          >
                            <i class="bi bi-trash"></i>
                          </button>
                        </form>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                {% else %}
                <p class="text-muted small mb-0 p-2 text-center">
                  Henüz açık görev yok.
                </p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- ORTA PANEL: 2 kart + işlemde olan görev (Gelecek aşamalarda eklenecek) -->
        <div class="col-lg-6">
          <!-- Orta panel içeriği buraya gelecek -->
        </div>

        <!-- SAĞ PANEL: (Gelecek aşamalarda eklenecek) -->
        <div class="col-lg-3">
          <!-- Sağ panel içeriği buraya gelecek -->
        </div>
      </div>
    </main>

    <!-- Bootstrap 5 JS Bundle (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
